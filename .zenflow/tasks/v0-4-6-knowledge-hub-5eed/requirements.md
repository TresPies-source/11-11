# Product Requirements Document: Knowledge Hub (Prompt Bridge v2)

**Version:** 1.0  
**Date:** January 15, 2026  
**Author:** Zenflow AI Agent  
**Status:** Draft

---

## 1. Executive Summary

The **Knowledge Hub** transforms the 11-11 platform from a collection of isolated tools into an interconnected knowledge ecosystem. This feature creates bidirectional workflows between **Dojo Sessions** (conversational thinking), the **Workbench** (editing workspace), the **Library** (reusable prompts), and **Seeds** (conceptual knowledge). Users will be able to capture insights from conversations, refine them in the Workbench, store them as structured knowledge artifacts, and inject that knowledge back into new sessions—creating a sustainable cycle of knowledge growth.

### Key Value Proposition

**Before:** Knowledge created in one part of the platform stays trapped there. A brilliant insight from a Dojo conversation disappears into the conversation history. Code generated by an agent can't easily be refined. Prompts and Seeds exist in isolation.

**After:** Every piece of knowledge can flow freely. Extract insights from conversations and save them as Seeds. Take code artifacts and open them in the Workbench for refinement. Start new Dojo sessions with existing Prompts or Seeds as context. Save Workbench content as either Prompts or Seeds. The platform becomes a living knowledge graph where every thought can be captured, refined, and reused.

---

## 2. Background & Context

### 2.1 Current State

The 11-11 platform v0.4.5 includes:
- **Dojo Sessions**: Full-page chat interface with DojoPacket schema, stored in a `sessions` table
- **Workbench**: File editing interface with tab management via Zustand store
- **Library (Librarian)**: Prompt storage and management via Google Drive
- **Seeds**: Conceptual knowledge artifacts stored in a PGlite database

### 2.2 The Problem

These four components exist as **isolated silos**:
1. Valuable insights from Dojo conversations are lost—no way to extract and save them
2. Code artifacts generated by agents can't be easily edited or refined
3. Prompts and Seeds can't be used as starting points for new conversations
4. Workbench content can't leverage existing knowledge artifacts
5. No traceability—users can't see how knowledge evolved from conversation → seed → refined prompt

### 2.3 Design Foundation

This PRD is based on:
- **Design Spec**: `02_Specs/11-11-prompt-bridge-redesign-spec.md`
- **Analysis Doc**: `02_Specs/11-11-prompt-bridge-redesign-analysis.md`

---

## 3. User Personas

### Primary Persona: Knowledge Worker (Power User)
- **Name**: Sarah, AI Product Manager
- **Goals**: Capture insights from brainstorming sessions, build a personal knowledge base, reuse proven patterns
- **Pain Points**: Loses great ideas from conversations, can't easily organize and retrieve knowledge, wastes time recreating prompts
- **Usage Pattern**: Daily Dojo sessions, frequent prompt refinement, growing collection of Seeds

### Secondary Persona: Developer
- **Name**: Marcus, Full-Stack Engineer  
- **Goals**: Extract code patterns from agent conversations, refine generated code, document best practices
- **Pain Points**: Generated code needs tweaking, wants to save proven patterns, struggles with context switching
- **Usage Pattern**: Uses Dojo for problem-solving, Workbench for refinement, Seeds for pattern storage

---

## 4. User Stories

### Epic 1: Save and Load from Workbench (Phase 1)

**US1.1 - Save Workbench Content as Prompt**
```
As a user working in the Workbench
I want to save my current file as a Prompt
So that I can reuse it later or share it with others
```
**Acceptance Criteria:**
- Save button in ActionBar opens SaveArtifactModal
- Modal allows me to select "Prompt" as the save type
- I can provide name, description, tags, and set public visibility
- After saving, the Prompt appears in my Library
- A knowledge_links entry connects the Workbench file to the new Prompt

**US1.2 - Save Workbench Content as Seed**
```
As a user working in the Workbench
I want to save my current file as a Seed
So that I can capture conceptual knowledge for later growth
```
**Acceptance Criteria:**
- Save button in ActionBar opens SaveArtifactModal
- Modal allows me to select "Seed" as the save type
- When Seed is selected, I see Type and Status dropdowns
- I can provide name, content, why_matters, revisit_when
- After saving, the Seed appears in my Seeds collection
- A knowledge_links entry connects the Workbench file to the new Seed

**US1.3 - Load Prompt into Workbench**
```
As a user browsing my Library
I want to open a Prompt in the Workbench
So that I can edit and refine it
```
**Acceptance Criteria:**
- PromptCard has an "Open in Workbench" button
- Clicking it navigates to /workbench and opens a new tab
- The tab is populated with the Prompt content
- The tab title matches the Prompt name
- The Workbench store tracks the source promptId

**US1.4 - Load Seed into Workbench**
```
As a user browsing my Seeds
I want to open a Seed in the Workbench
So that I can refine its content
```
**Acceptance Criteria:**
- SeedCard has an "Open in Workbench" button
- Clicking it navigates to /workbench and opens a new tab
- The tab is populated with the Seed content
- The tab title matches the Seed name
- The Workbench store tracks the source seedId

### Epic 2: Extract from Dojo Sessions (Phase 2)

**US2.1 - Save Full Dojo Session**
```
As a user finishing a valuable Dojo conversation
I want to save the entire session as a Prompt
So that I can reference the conversation later or use it as a template
```
**Acceptance Criteria:**
- "Save Session" button in Dojo header opens SaveSessionModal
- Modal shows session title pre-filled
- I can select "Full conversation (as a new Prompt)"
- After saving, a new Prompt is created with the full transcript
- A knowledge_links entry connects the session to the new Prompt

**US2.2 - Extract Key Insights as Seeds**
```
As a user reviewing a Dojo session
I want to extract specific insights as Seeds
So that I can capture the most valuable conceptual knowledge
```
**Acceptance Criteria:**
- SaveSessionModal has "Key insights (select messages to save as Seeds)" option
- Selecting this shows a message picker
- I can select specific agent messages to extract
- Each selected message becomes a new Seed
- knowledge_links entries connect each Seed back to the source session

**US2.3 - Save Individual Message as Prompt**
```
As a user reading a Dojo conversation
I want to save a single message as a Prompt
So that I can reuse an agent's suggested template or approach
```
**Acceptance Criteria:**
- Agent messages have a "..." context menu button
- Menu includes "Save as Prompt" option
- Clicking it opens a simplified save modal with message content pre-filled
- After saving, the Prompt is created and linked to the session

**US2.4 - Extract Message as Seed**
```
As a user reading a Dojo conversation
I want to extract a single message as a Seed
So that I can capture a specific insight for later growth
```
**Acceptance Criteria:**
- Agent messages have a "..." context menu button
- Menu includes "Extract as Seed" option
- Clicking it opens seed save modal with message content pre-filled
- After saving, the Seed is created and linked to the session

**US2.5 - Open Code in Workbench**
```
As a user viewing an agent message with code
I want to open that code in the Workbench
So that I can edit and refine it
```
**Acceptance Criteria:**
- Agent messages containing code blocks show "Open in Workbench" in context menu
- Clicking it navigates to /workbench and creates a new tab
- The tab is populated with the extracted code
- The tab title indicates it came from a Dojo session

### Epic 3: Start Sessions from Artifacts (Phase 3)

**US3.1 - Discuss Prompt in Dojo**
```
As a user viewing a Prompt in my Library
I want to start a Dojo session with this Prompt as context
So that I can get agent feedback on it or explore it further
```
**Acceptance Criteria:**
- PromptCard has a "Discuss in Dojo" button
- Clicking it creates a new Dojo session
- The session's situation field is pre-populated with the Prompt content
- A knowledge_links entry connects the new session to the source Prompt
- I'm redirected to the new session page

**US3.2 - Discuss Seed in Dojo**
```
As a user viewing a Seed
I want to start a Dojo session to explore this concept further
So that I can deepen my understanding or apply it to a new problem
```
**Acceptance Criteria:**
- SeedCard has a "Discuss in Dojo" button
- Clicking it creates a new Dojo session
- The session's situation field is pre-populated with the Seed content
- A knowledge_links entry connects the new session to the source Seed
- I'm redirected to the new session page

**US3.3 - Discuss Workbench Content in Dojo**
```
As a user editing a file in the Workbench
I want to ask the Dojo agent about my content
So that I can get feedback, suggestions, or answers to specific questions
```
**Acceptance Criteria:**
- ActionBar has a "Discuss with Dojo" button
- Clicking it opens a modal asking "What would you like to ask about this file?"
- I enter my question
- A new Dojo session is created with my question as the situation
- The active file content is added as the first perspective
- I'm redirected to the new session page

---

## 5. Functional Requirements

### 5.1 Database Schema

**New Table: `knowledge_links`**

Purpose: Track relationships between knowledge artifacts to create a knowledge graph.

```sql
CREATE TABLE knowledge_links (
  id TEXT PRIMARY KEY,
  source_type TEXT NOT NULL CHECK (source_type IN ('session', 'prompt', 'seed', 'file')),
  source_id TEXT NOT NULL,
  target_type TEXT NOT NULL CHECK (target_type IN ('session', 'prompt', 'seed', 'file')),
  target_id TEXT NOT NULL,
  relationship TEXT NOT NULL CHECK (relationship IN (
    'extracted_from',
    'discussed_in',
    'refined_in',
    'created_from'
  )),
  created_at TEXT NOT NULL,
  user_id TEXT NOT NULL
);

CREATE INDEX idx_knowledge_links_source ON knowledge_links(source_type, source_id);
CREATE INDEX idx_knowledge_links_target ON knowledge_links(target_type, target_id);
CREATE INDEX idx_knowledge_links_user ON knowledge_links(user_id);
```

**Relationship Types:**
- `extracted_from`: Seed/Prompt extracted from Session/Message
- `discussed_in`: Artifact discussed in a new Session
- `refined_in`: Artifact refined in Workbench
- `created_from`: Artifact created from another artifact

### 5.2 API Endpoints

**5.2.1 POST /api/hub/transfer**

Unified endpoint for all knowledge transfer operations.

**Request Body:**
```typescript
{
  operation: 'save_prompt' | 'save_seed' | 'extract_from_session' | 'create_session',
  source: {
    type: 'session' | 'prompt' | 'seed' | 'file' | 'workbench',
    id: string,
    content: string
  },
  target: {
    type: 'prompt' | 'seed' | 'session',
    metadata: {
      name?: string,
      description?: string,
      tags?: string[],
      public?: boolean,
      // Seed-specific
      seedType?: SeedType,
      seedStatus?: SeedStatus,
      why_matters?: string,
      revisit_when?: string,
      // Session-specific
      situation?: string,
      perspectives?: string[]
    }
  },
  userId: string
}
```

**Response:**
```typescript
{
  success: boolean,
  artifactId: string,
  linkId: string,
  message: string
}
```

**5.2.2 POST /api/dojo/create-from-context**

Create a new Dojo session pre-populated with context from an artifact.

**Request Body:**
```typescript
{
  artifactType: 'prompt' | 'seed' | 'file',
  artifactId: string,
  situation: string,
  perspectives?: string[]
}
```

**Response:**
```typescript
{
  sessionId: string,
  linkId: string
}
```

**5.2.3 GET /api/hub/lineage/{type}/{id}**

Retrieve the full lineage of a knowledge artifact.

**Response:**
```typescript
{
  artifact: {
    id: string,
    type: string,
    name: string,
    created_at: string
  },
  links: Array<{
    id: string,
    relationship: string,
    direction: 'inbound' | 'outbound',
    relatedArtifact: {
      id: string,
      type: string,
      name: string,
      created_at: string
    }
  }>
}
```

### 5.3 UI Components

**5.3.1 SaveArtifactModal** (`components/hub/SaveArtifactModal.tsx`)

Context-aware modal for saving from Workbench.

**Props:**
```typescript
{
  isOpen: boolean,
  onClose: () => void,
  sourceContent: string,
  sourceType: 'workbench' | 'file',
  sourceId?: string
}
```

**Fields:**
- Name (text input, required)
- Description (textarea, optional)
- Tags (tag input, optional)
- Save as (radio group: Prompt | Seed)
- **Conditional on Seed:**
  - Type dropdown (principle, pattern, question, route, artifact, constraint)
  - Status dropdown (new, growing, mature, compost)
  - Why it matters (textarea)
  - Revisit when (text input)
- Public toggle (boolean)

**5.3.2 SaveSessionModal** (`components/dojo/SaveSessionModal.tsx`)

Modal for extracting content from a Dojo session.

**Props:**
```typescript
{
  isOpen: boolean,
  onClose: () => void,
  sessionId: string,
  sessionTitle: string,
  messages: DojoMessage[]
}
```

**Fields:**
- Title (pre-filled, editable)
- Description (textarea)
- Tags (tag input)
- Extraction options (checkbox group):
  - Full conversation (as Prompt)
  - Key insights (select messages as Seeds)
  - Code artifacts (open in Workbench)

**5.3.3 Message Context Menu** (in `components/dojo/ChatMessage.tsx`)

**Menu Items:**
- Save as Prompt
- Extract as Seed
- Open in Workbench (conditional: only if message contains code block)

**5.3.4 Enhanced PromptCard** (in `components/shared/PromptCard.tsx`)

**New Actions:**
- Open in Workbench (button)
- Discuss in Dojo (button)

**5.3.5 Enhanced SeedCard** (in `components/seeds/seed-card.tsx`)

**New Actions:**
- Open in Workbench (button)
- Discuss in Dojo (button)

**5.3.6 Enhanced ActionBar** (in `components/workbench/ActionBar.tsx`)

**New Actions:**
- Discuss with Dojo (button)

### 5.4 State Management

**5.4.1 Workbench Store Extension**

Add to `lib/stores/workbench.store.ts`:

```typescript
interface WorkbenchState {
  // ... existing fields ...
  
  // New fields for tracking source artifacts
  loadFromArtifact: (
    artifactType: 'prompt' | 'seed',
    artifactId: string,
    name: string,
    content: string
  ) => void;
  
  getActiveTabSource: () => {
    type: 'prompt' | 'seed' | 'file' | null,
    id: string | null
  };
}
```

**5.4.2 Dojo Store Extension**

Add to `lib/stores/dojo.store.ts`:

```typescript
interface DojoSessionState {
  // ... existing fields ...
  
  // New fields for tracking context sources
  contextSource: {
    type: 'prompt' | 'seed' | 'file' | null,
    id: string | null
  } | null;
  
  setContextSource: (source: { type: string, id: string }) => void;
}
```

---

## 6. Non-Functional Requirements

### 6.1 Performance
- Modal open/close animations: < 200ms
- Save operations: < 2 seconds for success feedback
- Navigation between views: < 500ms
- Database queries: < 100ms for single artifact retrieval

### 6.2 Usability
- All modals follow existing design system (dark mode compatible)
- Context menus appear within 100ms of click
- Error messages are clear and actionable
- Success feedback uses toast notifications (2-second display)

### 6.3 Data Integrity
- All knowledge_links entries include timestamps
- Deleted artifacts cascade to update or remove links
- User can only see their own artifacts (respects user_id filtering)
- Public artifacts are accessible to all users

### 6.4 Accessibility
- All buttons have aria-labels
- Modals trap focus and support ESC key to close
- Form fields have proper labels
- Color contrast meets WCAG AA standards

### 6.5 Security
- Authentication required for all API endpoints (except in dev mode)
- User can only modify their own artifacts
- XSS protection on all user-generated content
- SQL injection prevention via parameterized queries

---

## 7. Technical Constraints

### 7.1 Technology Stack
- **Frontend:** Next.js 14 with App Router, React 18, TypeScript
- **State Management:** Zustand
- **Database:** PGlite (client-side SQL database)
- **Styling:** Tailwind CSS
- **Animations:** Framer Motion
- **Authentication:** NextAuth.js

### 7.2 Database
- Using PGlite (`lib/pglite/client.ts`)
- No Supabase (migrated away on Jan 12, 2026)
- Migrations in `lib/pglite/migrations/`
- Follow existing patterns in `lib/pglite/seeds.ts` and `lib/pglite/prompts.ts`

### 7.3 API Patterns
- Follow existing API route structure in `app/api/`
- Use `auth()` from `@/lib/auth` for authentication
- Support dev mode with `process.env.NEXT_PUBLIC_DEV_MODE === 'true'`
- Return NextResponse with proper status codes

### 7.4 File Organization
- Components in `components/`
- API routes in `app/api/`
- Database operations in `lib/pglite/`
- Types in `lib/types.ts` or feature-specific `types.ts` files

---

## 8. Success Metrics

### 8.1 Adoption Metrics
- **Target:** 60% of active users save at least one artifact within first week
- **Target:** 40% of Dojo sessions result in saved artifacts (Prompt or Seed)
- **Target:** 30% of saved artifacts are later loaded into Workbench or discussed in new sessions

### 8.2 Engagement Metrics
- **Target:** Average user creates 5+ knowledge_links per week
- **Target:** 20% of new Dojo sessions start with context from existing artifacts
- **Target:** 50% reduction in "lost knowledge" complaints from user feedback

### 8.3 Quality Metrics
- **Target:** < 5% error rate on save operations
- **Target:** < 2 seconds average save operation duration
- **Target:** Zero data loss incidents

---

## 9. Assumptions & Dependencies

### 9.1 Assumptions
1. Users understand the difference between Prompts (templates) and Seeds (concepts)
2. Google Drive integration for Prompts is working correctly
3. PGlite database has sufficient storage for knowledge_links growth
4. Users have a clear mental model of the knowledge graph metaphor
5. Authentication system correctly provides user identity

### 9.2 Dependencies
- **Must Be Working:** Dojo session system with message storage
- **Must Be Working:** Workbench tab management
- **Must Be Working:** Seeds database with full CRUD operations
- **Must Be Working:** Library/Librarian prompt storage
- **Must Be Working:** Authentication via NextAuth

### 9.3 Open Questions for Clarification
1. **Prompt Storage**: Are prompts stored in PGlite or only in Google Drive? (Impacts save workflow)
2. **Session Persistence**: Are Dojo session messages persisted to the database? (Impacts extraction workflow)
3. **File References**: How do we track Workbench file IDs for knowledge_links? (Need consistent ID strategy)
4. **Public vs Private**: Should knowledge_links respect artifact privacy settings? (Impacts lineage view)

---

## 10. Out of Scope (For This Version)

The following features are explicitly **not included** in the initial Knowledge Hub implementation:

### 10.1 Advanced Features
- ❌ Bulk operations (save multiple messages at once)
- ❌ Knowledge graph visualization UI
- ❌ Automatic tagging or categorization
- ❌ Search across knowledge_links
- ❌ Artifact versioning or history
- ❌ Collaborative editing or sharing workflows

### 10.2 Optimization Features
- ❌ Caching for frequently accessed artifacts
- ❌ Lazy loading for large conversation histories
- ❌ Background sync for offline-first workflows

### 10.3 Admin/Analytics Features
- ❌ Admin dashboard for knowledge graph metrics
- ❌ Usage analytics for artifact types
- ❌ User engagement reports

### 10.4 Future Enhancements
These may be considered for v2:
- Smart suggestions (e.g., "This looks similar to Seed X")
- Automatic extraction of code blocks from messages
- Integration with external knowledge bases
- Export knowledge graph in standard formats (GraphML, etc.)
- Duplicate detection for similar artifacts

---

## 11. Phased Rollout Plan

### Phase 1: Core Save/Load Workflow (Highest Priority)
**Duration:** Week 1  
**Goal:** Users can save from Workbench and load back

**Deliverables:**
1. Create `knowledge_links` table migration
2. Implement `SaveArtifactModal` component
3. Implement `/api/hub/transfer` endpoint
4. Add "Open in Workbench" buttons to PromptCard and SeedCard
5. Update Workbench to detect and load source artifacts

**Success Criteria:**
- User can save a Workbench file as a Prompt
- User can save a Workbench file as a Seed
- User can open a Prompt in Workbench
- User can open a Seed in Workbench
- All operations create knowledge_links entries

### Phase 2: Session Extraction Workflow (Medium Priority)
**Duration:** Week 2  
**Goal:** Users can extract knowledge from Dojo sessions

**Deliverables:**
1. Implement `SaveSessionModal` component
2. Add context menu to `ChatMessage` component
3. Extend `/api/hub/transfer` for session extraction
4. Add "Save Session" button handler in Dojo page

**Success Criteria:**
- User can save full session as Prompt
- User can extract individual messages as Seeds
- User can extract code blocks to Workbench
- Message context menu works on all agent messages

### Phase 3: Context Injection Workflow (Lower Priority)
**Duration:** Week 3  
**Goal:** Users can start new sessions with existing artifacts

**Deliverables:**
1. Add "Discuss in Dojo" buttons to PromptCard and SeedCard
2. Implement `/api/dojo/create-from-context` endpoint
3. Add "Discuss with Dojo" button to Workbench ActionBar
4. Update Dojo page to handle pre-populated context

**Success Criteria:**
- User can start Dojo session from Prompt
- User can start Dojo session from Seed
- User can discuss Workbench file with Dojo
- All operations create knowledge_links entries

---

## 12. Risk Assessment

| Risk | Probability | Impact | Mitigation Strategy |
|------|------------|--------|---------------------|
| **Prompts not in PGlite** | High | High | Investigate prompt storage, possibly add prompts table to PGlite |
| **Complex modal UX** | Medium | Medium | Follow existing modal patterns, test with users early |
| **Performance with many links** | Low | Medium | Add database indexes, implement pagination if needed |
| **User confusion about artifact types** | Medium | High | Add inline help text, create user guide, improve naming |
| **Knowledge_links growth** | Medium | Low | Monitor database size, implement cleanup for old links |

---

## 13. Documentation Requirements

### 13.1 Developer Documentation
- API endpoint documentation with request/response examples
- Database schema documentation
- Component prop interfaces and usage examples
- State management patterns for knowledge_links

### 13.2 User Documentation
- Feature announcement blog post (out of scope for this implementation)
- In-app tooltips for new buttons
- Error message copy that guides users to success

---

## Appendix A: Terminology

- **Knowledge Hub**: The overall system connecting all knowledge artifacts
- **Knowledge Artifact**: Any piece of stored knowledge (Prompt, Seed, Session, File)
- **Knowledge Link**: A database record tracking relationships between artifacts
- **Knowledge Graph**: The conceptual network formed by all artifacts and their links
- **Lineage**: The history of an artifact showing all related artifacts
- **Context Injection**: Starting a new session with existing knowledge as input
- **Extraction**: Saving knowledge from a session or message as a new artifact

---

## Appendix B: References

- **Design Specification**: `02_Specs/11-11-prompt-bridge-redesign-spec.md`
- **Analysis Document**: `02_Specs/11-11-prompt-bridge-redesign-analysis.md`
- **Existing Components**: 
  - `components/shared/PromptCard.tsx`
  - `components/seeds/seed-card.tsx`
  - `components/workbench/ActionBar.tsx`
  - `components/dojo/ChatMessage.tsx`
- **Database Patterns**: 
  - `lib/pglite/seeds.ts`
  - `lib/pglite/prompts.ts`
- **API Patterns**: 
  - `app/api/seeds/route.ts`
  - `app/api/dojo/route.ts`

---

**Document Status**: Ready for Technical Specification phase  
**Next Steps**: Review with stakeholders, address open questions, proceed to technical design
